(function(){function e(e){this.options=e,this.init()}var t;"ontouchstart"in window?(t=function(e){var t=this;t.parent=e,t.last=null,t.touches={},t.data=[],t.parent.addEventListener("touchstart",t.touch(),!1),t.parent.addEventListener("touchmove",t.touch(),!1),t.parent.addEventListener("touchend",t.touch(),!1)},t.prototype={threshold:5,findItem:function(e){var t,i,n=this.data;for(t=0;t<n.length;t++)if(i=n[t],i.element===e)return i},addListener:function(e,t,n){var a=this,r=a.findItem(e);r?i=r.events[t]:(r={element:e,events:{}},a.data.push(r),i=null),i||(r.events[t]=i=[]),i.push(n)},removeListener:function(e,t,i){var n,a,r=this,s=r.findItem(e);s&&(n=s.events[t],n&&(a=n.indexOf(i),a>=0&&n.splice(a,1)))},ignore:function(){},call:function(e,t){for(var i=this,n=function(n){var a,s=null;for(a=0;a<i.data.length;a++)if(i.data[a].element===n){s=i.data[a];break}if(s){var o=s.events[e];o&&i.forEach(o,function(n){var a,s={type:e};for(a in t)s[a]=t[a];s.preventDefault=i.ignore,s.stopPropagation=r,n(s)})}},a=!1,r=function(){a=!0},s=t.target;s&&(n(s),!a&&s!==i.parent);)s=s.parentNode},forEach:function(e,t){Array.prototype.forEach.call(e,t)},touch:function(){var e=this;return function(t){t.preventDefault(),"touchstart"==t.type?e.forEach(t.changedTouches,function(t){e.touches[t.identifier]=[!1,t],e.call("mousedown",t)}):"touchmove"==t.type?e.forEach(t.changedTouches,function(t){var i=e.touches[t.identifier];e.touches[t.identifier]=[Math.abs(t.clientX-i.clientX)>e.threshold||Math.abs(t.clientY-i.clientY)>e.threshold,t],e.call("mousemove",t)}):"touchend"==t.type&&e.forEach(t.changedTouches,function(t){e.call("mouseup",t);var i=e.touches[t.identifier];delete e.touches[t.identifier],i&&!i[0]&&e.call("click",t)})}}}):(t=function(e){},t.prototype={addListener:function(e,t,i){e.addEventListener(t,i,!1)},removeListener:function(e,t,i){e.removeEventListener(t,i,!1)}}),t.prototype.getPoint=function(e){if("offsetX"in e)return{x:e.offsetX,y:e.offsetY};var t=e.target.getBoundingClientRect(),i=document.documentElement,n=window;return{x:e.pageX-(t.left+n.pageXOffset-i.clientLeft),y:e.pageY-(t.top+n.pageYOffset-i.clientTop)}},e.prototype={_classes:{list:"fa fa-list",prev:"fa fa-step-backward",play:"fa fa-play",next:"fa fa-step-forward",pause:"fa fa-pause"},extend:function(e,t){for(var i in t)e[i]=t[i];return e},init:function(){var e=this,t=e.options.container;e.classes=e.extend({},e._classes),e.options.classes&&e.extend(e.classes,e.options.classes),t.classList.add("ge-player"),t.innerHTML='<div class="image"></div><div class="buttons"><i data="list" class="'+e.classes.list+'"></i></div><div class="control"><div class="title"></div><i data="prev" class="'+e.classes.prev+'"></i><i data="play" class="'+e.classes.play+'"></i><i data="next" class="'+e.classes.next+'"></i></div><div class=progress><div class="wrap"><div class="bar"><div class="played"></div></div><div class="cursor"></div><div class="time"></div></div></div><div class="playlist hide"></div>',e.image=t.querySelector(".image"),e.title=t.querySelector(".title"),e.btprev=t.querySelector("*[data=prev]"),e.btplay=t.querySelector("*[data=play]"),e.btnext=t.querySelector("*[data=next]"),e.btplaylist=t.querySelector("*[data=list]"),e.playlist=t.querySelector(".playlist"),e.prbar=t.querySelector(".bar"),e.prcur=t.querySelector(".cursor"),e.prtime=t.querySelector(".time"),e.brplayed=t.querySelector(".played"),e.audio=new Audio,e.options.image&&(e.image.innerHTML='<img src="'+e.safeHTML(e.options.image)+'">'),e.setSongs([]),e.bindEvents()},bindEvents:function(){var e=this,i=null,n=new t(e.options.container);n.addListener(e.btplaylist,"click",function(t){this.classList.toggle("active"),e.playlist.classList.toggle("hide")}),n.addListener(e.btprev,"click",function(t){e.play(e.previous())}),n.addListener(e.btnext,"click",function(t){e.play(e.next())}),n.addListener(e.btplay,"click",function(t){e.current<0?e.play(0):e.audio.paused?e.audio.play():e.audio.pause()}),e.audio.addEventListener("ended",function(t){e.play(e.next())},!1),e.audio.addEventListener("timeupdate",function(t){var n=this.currentTime,a=e.duration;if(a||(a=e.duration=this.duration),!i){var r=a?n/a*100+"%":0;e.prcur.style.left=r,e.brplayed.style.width=r}e.prtime.innerHTML=e.timestr(n)+"/"+e.timestr(a)},!1);var a=function(t){var i=["play","pause"];"pause"==t.type&&i.reverse();var n=e.btplay.classList;e.classes[i[0]].split(/\s+/).forEach(function(e){n.remove(e)}),e.classes[i[1]].split(/\s+/).forEach(function(e){n.add(e)}),e.image.classList["play"==t.type?"add":"remove"]("ge-roll")};e.audio.addEventListener("play",a,!1),e.audio.addEventListener("pause",a,!1),n.addListener(e.playlist,"click",function(t){var i=Array.prototype.indexOf.call(this.childNodes,t.target);i>=0&&e.play(i)});var r=function(t,i){var n=t/e.prbar.offsetWidth;0>n?n=0:n>1&&(n=1),e.prcur.style.left=e.brplayed.style.width=100*n+"%",i&&(e.audio.currentTime=~~(n*e.duration))};n.addListener(e.prbar,"click",function(e){e.preventDefault();var t=n.getPoint(e).x;r(t,!0)});var s=function(e){i&&(i.moved=!0,r(e.clientX-i.delta))},o=function(e){i&&(e.preventDefault(),i=null)},c=function(e){i&&(r(e.clientX-i.delta,!0),o(e))},l=function(t){t.preventDefault(),i={delta:t.clientX-e.brplayed.offsetWidth}};n.addListener(e.prcur,"mousedown",l),n.addListener(e.options.container,"mousemove",s),n.addListener(e.options.container,"mouseup",c),n.addListener(e.options.container,"mouseleave",o)},safeHTML:function(e){return e.replace(/[&"<]/g,function(e){return{"&":"&amp;",'"':"&quot;","<":"&lt;"}[e]})},setSongs:function(e){var t=this,i=[];t.songs=e,t.songs.forEach(function(e){var n=t.safeHTML(e.name);i.push('<div title="'+n+'">'+n+"</div>")}),t.playlist.innerHTML=i.join(""),t.current=-1,t.duration=0},play:function(e){var t=this;if(e>=0&&e<t.songs.length){if(t.current==e)t.audio.currentTime=0;else{var i=t.playlist.childNodes,n=i[t.current];n&&n.classList.remove("active"),t.current=e,i[t.current].classList.add("active");var a=t.songs[t.current];t.title.innerHTML=t.safeHTML(a.name),t.audio.src=a.url,t.duration=a.duration?a.duration/1e3:null;var r=a.image||t.options.image;r&&(t.image.innerHTML='<img src="'+t.safeHTML(r)+'">')}t.prtime.innerHTML="",t.prcur.style.left=0,t.brplayed.style.width=0,t.audio.play()}},previous:function(){return(this.current-1)%this.songs.length},next:function(){return(this.current+1)%this.songs.length},timestr:function(e){if(isNaN(e))return"??:??";var t=Math.floor(e/60);return e=Math.floor(e)%60,10>e&&(e="0"+e),10>t&&(t="0"+t),t+":"+e}},window.Player=e}).call({});