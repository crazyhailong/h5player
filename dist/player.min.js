(function(){function t(t){this.options=t,this.init()}var e;"ontouchstart"in window?(e=function(t){var e=this;e.parent=t,e.last=null,e.touches={},e.data=[],e.parent.addEventListener("touchstart",e.touch(),!1),e.parent.addEventListener("touchmove",e.touch(),!1),e.parent.addEventListener("touchend",e.touch(),!1)},e.prototype={threshold:5,findItem:function(t){var e,a,i=this.data;for(e=0;e<i.length;e++)if(a=i[e],a.element===t)return a},addListener:function(t,e,a){var n=this,r=n.findItem(t);r?i=r.events[e]:(r={element:t,events:{}},n.data.push(r),i=null),i||(r.events[e]=i=[]),i.push(a)},removeListener:function(t,e,a){var i,n,r=this,s=r.findItem(t);s&&(i=s.events[e],i&&(n=i.indexOf(a),n>=0&&i.splice(n,1)))},ignore:function(){},call:function(t,e){for(var a=this,i=function(i){var n,s=null;for(n=0;n<a.data.length;n++)if(a.data[n].element===i){s=a.data[n];break}if(s){var o=s.events[t];o&&a.forEach(o,function(n){var s,o={type:t};for(s in e)o[s]=e[s];o.preventDefault=a.ignore,o.stopPropagation=r,n.call(i,o)})}},n=!1,r=function(){n=!0},s=e.target;s&&(i(s),!n&&s!==a.parent);)s=s.parentNode},forEach:function(t,e){Array.prototype.forEach.call(t,e)},touch:function(){var t=this;return function(e){e.preventDefault(),"touchstart"==e.type?t.forEach(e.changedTouches,function(e){t.touches[e.identifier]={evt:e},t.call("mousedown",e)}):"touchmove"==e.type?t.forEach(e.changedTouches,function(e){var a=t.touches[e.identifier],i=a.evt;a.moved=Math.abs(e.clientX-i.clientX)>t.threshold||Math.abs(e.clientY-i.clientY)>t.threshold,a.moved&&(a.evt=e,t.call("mousemove",e))}):"touchend"==e.type&&t.forEach(e.changedTouches,function(e){t.call("mouseup",e);var a=t.touches[e.identifier];delete t.touches[e.identifier],a&&!a.moved&&t.call("click",e)})}}}):(e=function(t){},e.prototype={addListener:function(t,e,a){t.addEventListener(e,a,!1)},removeListener:function(t,e,a){t.removeEventListener(e,a,!1)}}),e.prototype.getPoint=function(t){if("offsetX"in t)return{x:t.offsetX,y:t.offsetY};var e=t.target.getBoundingClientRect(),a=document.documentElement,i=window;return{x:t.pageX-(e.left+i.pageXOffset-a.clientLeft),y:t.pageY-(e.top+i.pageYOffset-a.clientTop)}},t.prototype={_classes:{list:"fa fa-list",prev:"fa fa-step-backward",play:"fa fa-play",next:"fa fa-step-forward",pause:"fa fa-pause"},extend:function(t,e){for(var a in e)t[a]=e[a];return t},init:function(){var t=this,e=t.options.container;t.classes=t.extend({},t._classes),t.options.classes&&t.extend(t.classes,t.options.classes),e.classList.add("ge-player"),e.innerHTML='<div class="image"></div><div class="buttons"><i data="list" class="'+t.classes.list+'"></i></div><div class="control"><div class="title"></div><i data="prev" class="'+t.classes.prev+'"></i><i data="play" class="'+t.classes.play+'"></i><i data="next" class="'+t.classes.next+'"></i></div><div class=progress><div class="wrap"><div class="barwrap"><div class="bar"><div class="played"></div></div></div><div class="cursor"></div><div class="time"></div></div></div><div class="playlist hide"></div>',t.image=e.querySelector(".image"),t.title=e.querySelector(".title"),t.btprev=e.querySelector("*[data=prev]"),t.btplay=e.querySelector("*[data=play]"),t.btnext=e.querySelector("*[data=next]"),t.btplaylist=e.querySelector("*[data=list]"),t.playlist=e.querySelector(".playlist"),t.prwrap=e.querySelector(".barwrap"),t.prcur=e.querySelector(".cursor"),t.prtime=e.querySelector(".time"),t.brplayed=e.querySelector(".played"),t.audio=new Audio,t.rotateData={deg:0,rotating:!1},t.doRotate=t._doRotate.bind(t),t.options.image&&(t.image.innerHTML='<img src="'+t.safeHTML(t.options.image)+'">'),t.setSongs([]),t.bindEvents()},bindEvents:function(){var t=this,a=null,i=new e(t.options.container);i.addListener(t.btplaylist,"click",function(e){this.classList.toggle("active"),t.playlist.classList.toggle("hide")}),i.addListener(t.btprev,"click",function(e){t.play(t.previous())}),i.addListener(t.btnext,"click",function(e){t.play(t.next())}),i.addListener(t.btplay,"click",function(e){t.current<0?t.play(0):t.audio.paused?t.audio.play():t.audio.pause()}),t.audio.addEventListener("ended",function(e){t.play(t.next())},!1),t.audio.addEventListener("timeupdate",function(e){var i=this.currentTime,n=t.duration;if(n||(n=t.duration=this.duration),!a){var r=n?i/n*100+"%":0;t.prcur.style.left=r,t.brplayed.style.width=r}t.prtime.innerHTML=t.timestr(i)+"/"+t.timestr(n)},!1);var n=function(e){var a=["play","pause"];"pause"==e.type&&a.reverse();var i=t.btplay.classList;t.classes[a[0]].split(/\s+/).forEach(function(t){i.remove(t)}),t.classes[a[1]].split(/\s+/).forEach(function(t){i.add(t)}),t.rotate("play"==e.type)};t.audio.addEventListener("play",n,!1),t.audio.addEventListener("pause",n,!1),i.addListener(t.playlist,"click",function(e){var a=Array.prototype.indexOf.call(this.childNodes,e.target);a>=0&&t.play(a)});var r=function(e,a){var i=e/t.prwrap.offsetWidth;0>i?i=0:i>1&&(i=1),t.prcur.style.left=t.brplayed.style.width=100*i+"%",a&&(t.audio.currentTime=~~(i*t.duration))};i.addListener(t.prwrap,"click",function(t){t.preventDefault();var e=i.getPoint(t).x;r(e,!0)});var s=function(t){a&&(a.moved=!0,r(t.clientX-a.delta))},o=function(t){a&&(t.preventDefault(),a=null)},c=function(t){a&&(r(t.clientX-a.delta,!0),o(t))},l=function(e){e.preventDefault(),a={delta:e.clientX-t.brplayed.offsetWidth}};i.addListener(t.prcur,"mousedown",l),i.addListener(t.options.container,"mousemove",s),i.addListener(t.options.container,"mouseup",c),t.options.container.addEventListener("mouseleave",o,!1)},_doRotate:function(){var t=this,e=t.rotateData;t.image.setAttribute("style","-webkit-transform:rotate("+e.deg+"deg);transform:rotate("+e.deg+"deg);"),e.deg+=.5,e.deg>=360&&(e.deg-=360),e.rotating&&requestAnimationFrame(t.doRotate)},rotate:function(t){var e=this,a=e.rotateData;a.rotating!=t&&(a.rotating=t)&&e.doRotate()},safeHTML:function(t){return t.replace(/[&"<]/g,function(t){return{"&":"&amp;",'"':"&quot;","<":"&lt;"}[t]})},setSongs:function(t){var e=this,a=[];e.songs=t,e.songs.forEach(function(t){var i=e.safeHTML(t.name);a.push('<div title="'+i+'">'+i+"</div>")}),e.playlist.innerHTML=a.join(""),e.current=-1,e.duration=0},play:function(t){var e=this;if(t>=0&&t<e.songs.length){if(e.current==t)e.audio.currentTime=0;else{var a=e.playlist.childNodes,i=a[e.current];i&&i.classList.remove("active"),e.current=t,a[e.current].classList.add("active");var n=e.songs[e.current];e.title.innerHTML=e.safeHTML(n.name),e.audio.src=n.url,e.duration=n.duration?n.duration/1e3:null;var r=n.image||e.options.image;r&&(e.image.innerHTML='<img src="'+e.safeHTML(r)+'">',e.rotateData.deg=0)}e.prtime.innerHTML="",e.prcur.style.left=0,e.brplayed.style.width=0,e.audio.play()}},previous:function(){return(this.current-1)%this.songs.length},next:function(){return(this.current+1)%this.songs.length},timestr:function(t){if(isNaN(t))return"??:??";var e=Math.floor(t/60);return t=Math.floor(t)%60,10>t&&(t="0"+t),10>e&&(e="0"+e),e+":"+t}},window.Player=t}).call({});