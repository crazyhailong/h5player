/**
 * H5Player - A simple but powerful HTML5 music player
 * @version v1.1.3
 * @license MIT
 * @author Gerald <gera2ld@163.com>
 */
(function(){"use strict";function t(){this.data=[],this.last=0}function e(t){this.options=t,this.init(),i.push(this)}t.prototype={setLyric:function(t){var e=this.data=[];if(this.last=0,t){var i=/^\[([^\]]*)\]\s*(.*)$/;t.split(/\n/).forEach(function(t){var n=t.match(i);if(n){var s=0;n[1].split(/:/).forEach(function(t){s=60*s+Number(t)}),e.push([s,n[2]])}})}},getLyricAtTime:function(t){var e,i=this,n=i.data,s=i.last,r=n[s]||n[s=0];if(r)if(r[0]<t){for(;(e=n[++s])&&e[0]<=t;)r=e;i.last=s-1}else{for(;r&&r[0]>t;)r=n[--s];i.last=s}return r?r[1]:""}};var i=[];e.prototype={_classes:{list:"fa fa-list",prev:"fa fa-step-backward",play:"fa fa-play",next:"fa fa-step-forward",pause:"fa fa-pause"},themes:["normal","simple"],extend:function(t,e){for(var i in e)t[i]=e[i];return t},init:function(){var e=this,i=e.options.container;e.classes=e.extend({},e._classes),e.options.classes&&e.extend(e.classes,e.options.classes),i.classList.add("h5p");var n=e.themes.indexOf(e.options.theme);0>n&&(n=0),i.classList.add("h5p-"+(e.theme=e.themes[n])),i.innerHTML='<div class="h5p-image"></div><div class="h5p-buttons"><i data="list" class="h5p-button '+e.classes.list+'"></i></div><div class="h5p-info"><div class="h5p-title"></div><div class="h5p-artist"></div></div><div class="h5p-control"><i data="prev" class="h5p-button '+e.classes.prev+'"></i><i data="play" class="h5p-button '+e.classes.play+'"></i><i data="next" class="h5p-button '+e.classes.next+'"></i></div><div class="h5p-progress"><div class="h5p-wrap"><div class="h5p-bar"><div class="h5p-played"></div></div><div class="h5p-cursor"></div><div class="h5p-time"></div></div></div><div class="h5p-lyric"></div><div class="h5p-playlist"></div>';var s=i.querySelector.bind(i);e.image=s(".h5p-image"),e.title=s(".h5p-title"),e.artist=s(".h5p-artist"),e.playlist=s(".h5p-playlist"),e.prwrap=s(".h5p-wrap"),e.prcur=s(".h5p-cursor"),e.prtime=s(".h5p-time"),e.brplayed=s(".h5p-played"),e.lyric=s(".h5p-lyric"),Array.prototype.forEach.call(i.querySelectorAll(".h5p-button"),function(t){e["bt"+t.getAttribute("data")]=t}),e.audio=new Audio,e.options.image&&(e.image.innerHTML='<img src="'+e.safeHTML(e.options.image)+'">'),e.setSongs([]),e.lyricParser=new t,e.bindEvents()},prevent:function(t){t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation())},touch:function(t){var e=this;return function(i){e.prevent(i),[].forEach.call(i.changedTouches,function(i){t.call(e,i)})}},getPoint:function(t){if("offsetX"in t)return{x:t.offsetX,y:t.offsetY};var e=t.target.getBoundingClientRect(),i=document.documentElement,n=window;return{x:t.pageX-(e.left+n.pageXOffset-i.clientLeft),y:t.pageY-(e.top+n.pageYOffset-i.clientTop)}},bindEvents:function(){var t=this,e=null;t.btlist.addEventListener("touchstart",t.touch(t.toggleList),!1),t.btlist.addEventListener("click",t.toggleList.bind(t),!1),t.btprev.addEventListener("touchstart",t.touch(t.playPrev),!1),t.btprev.addEventListener("click",t.playPrev.bind(t),!1),t.btnext.addEventListener("touchstart",t.touch(t.playNext),!1),t.btnext.addEventListener("click",t.playNext.bind(t),!1),t.btplay.addEventListener("touchstart",t.touch(t.togglePlay),!1),t.btplay.addEventListener("click",t.togglePlay.bind(t),!1),t.audio.addEventListener("ended",t.playAnother.bind(t),!1),t.audio.addEventListener("timeupdate",function(i){var n=this.currentTime,s=t.duration;if(s||(s=t.duration=this.duration),!e){var r=s?n/s*100+"%":0;t.prcur.style.left=r,t.brplayed.style.width=r}t.prtime.innerHTML=t.timestr(n)+" / "+t.timestr(s),t.lyric.innerHTML=t.safeHTML(t.lyricParser.getLyricAtTime(n))},!1);var n=function(e){var n=["play","pause"],s=0;"play"==e.type?i.forEach(function(e){e!==t&&e.audio.pause()}):s=1;var r=t.btplay.classList;t.classes[n[s]].split(/\s+/).forEach(function(t){r.remove(t)}),t.classes[n[1-s]].split(/\s+/).forEach(function(t){r.add(t)}),t.image.classList["play"==e.type?"add":"remove"]("h5p-roll")};t.audio.addEventListener("play",n,!1),t.audio.addEventListener("pause",n,!1),t.playlist.addEventListener("click",function(e){t.prevent(e);var i=Array.prototype.indexOf.call(this.childNodes,e.target);i>=0&&t.play(i)},!1);var s=function(e,i){var n=e/t.prwrap.offsetWidth;0>n?n=0:n>1&&(n=1),t.prcur.style.left=t.brplayed.style.width=100*n+"%",i&&(t.audio.currentTime=~~(n*t.duration))},r=function(e){t.prevent(e);var i=t.getPoint(e).x;s(i,!0)};t.prwrap.addEventListener("touchstart",t.touch(r),!1),t.prwrap.addEventListener("click",r,!1);var a=function(i){t.prevent(i),e.moved=!0,s(i.clientX-e.delta)},o=t.touch(a),l=function(i){t.prevent(i),e=null;var n=t.options.container;n.removeEventListener("touchmove",o,!1),n.removeEventListener("mousemove",a,!1),n.removeEventListener("touchend",d,!1),n.removeEventListener("mouseup",c,!1)},c=function(t){s(t.clientX-e.delta,!0),l(t)},d=t.touch(c),p=function(i){if(t.prevent(i),!e){e={delta:i.clientX-t.brplayed.offsetWidth};var n=t.options.container;n.addEventListener("touchmove",o,!1),n.addEventListener("mousemove",a,!1),n.addEventListener("touchend",d,!1),n.addEventListener("mouseup",c,!1)}};t.prcur.addEventListener("touchstart",t.touch(p),!1),t.prcur.addEventListener("mousedown",p,!1),t.prcur.addEventListener("click",t.prevent,!1)},safeHTML:function(t){return t.replace(/[&"<]/g,function(t){return{"&":"&amp;",'"':"&quot;","<":"&lt;"}[t]})},toggleList:function(t){var e=this;e.prevent(t),e.btlist.classList.toggle("h5p-active");var i=e.playlist.style.display;e.playlist.style.display=i?"":"block"},togglePlay:function(t){var e=this;e.prevent(t),e.current<0?e.play(0):e.audio.paused?e.audio.play():e.audio.pause()},playPrev:function(t){this.prevent(t),this.play(this.previous())},playNext:function(t){this.prevent(t),this.play(this.next())},playAnother:function(){this.playNext()},setSongs:function(t){var e=this,i=[];e.songs=t,e.songs.forEach(function(t){var n=e.safeHTML(t.name);i.push('<div title="'+n+'">'+n+"</div>")}),e.playlist.innerHTML=i.join(""),e.current=-1,e.audio.src="",e.duration=0,e.showInfo(e.songs[0])},showInfo:function(t){var e,i=this;t=t||{},"simple"==i.theme&&(e=t.smallimage||i.options.smallimage),e=e||t.image||i.options.image||"",e&&(i.image.innerHTML='<img src="'+i.safeHTML(e)+'">'),i.title.innerHTML=i.safeHTML(t.name||""),i.artist.innerHTML=i.safeHTML(t.artist||"")},getLyric:function(t){var e=this,i=e.songs[e.current];if("lyric"in i)e.lyricParser.setLyric(i.lyric);else if(e.lyricParser.setLyric(),"lyricjsonp"in i){var n,s="setLyric"+Date.now().toString(16)+(~~(65535*Math.random())).toString(16);window[s]=function(t){200!=t.code?i.lyric=null:(i.lyric=t.lyric,i===e.songs[e.current]&&e.lyricParser.setLyric(i.lyric)),delete window[s],n&&(clearTimeout(n),n=null)};var r=document.createElement("script");r.src=i.lyricjsonp+(/\?/.test(i.lyricjsonp)?"&":"?")+"jsonp="+s,r.onload=function(){document.body.removeChild(r)},document.body.appendChild(r),t&&(n=setTimeout(function(){delete window[s],n=null},t))}},play:function(t){var e=this;if(t>=0&&t<e.songs.length){if(e.current==t)e.audio.currentTime=0;else{var i=e.playlist.childNodes,n=i[e.current];n&&n.classList.remove("h5p-active"),e.current=t,i[e.current].classList.add("h5p-active");var s=e.songs[e.current];e.audio.src=s.url,e.duration=s.duration?s.duration/1e3:null,e.showInfo(s),"simple"!=e.theme&&(e.lyric.innerHTML="",e.getLyric(1e4))}e.prtime.innerHTML="",e.prcur.style.left=0,e.brplayed.style.width=0,e.audio.play()}},previous:function(){return(this.current+this.songs.length-1)%this.songs.length},next:function(){return(this.current+1)%this.songs.length},timestr:function(t){if(isNaN(t))return"??:??";var e=Math.floor(t/60);return t=Math.floor(t)%60,10>t&&(t="0"+t),10>e&&(e="0"+e),e+":"+t},destroy:function(){var t=this;t.lyricParser=null,t.audio.src="",t.audio=null,t.options.container.innerHTML="",t.options.container.classList.remove("h5p");var e=i.indexOf(this);e>=0&&i.splice(e,1)}},window.Player=e}).call({});