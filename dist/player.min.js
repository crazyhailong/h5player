/**
 * H5Player - A simple but powerful HTML5 music player
 * @version v1.1.3
 * @license MIT
 * @author Gerald <gera2ld@163.com>
 */
(function(){"use strict";function e(){this.data=[]}function t(t){var i=this;i.parent=t,i.events=new e,i.delegates=new e,i.handler=i._handler.bind(i),"ontouchstart"in window&&i.initTouch(),"onmousedown"in window&&i.initMouse()}function i(){this.data=[],this.last=0}function n(e){this.options=e,this.init(),a.push(this)}"undefined"==typeof Array.prototype.find&&(Array.prototype.find=function(e){for(var t=this,i=0;i<t.length;i++){var n=t[i];if(e(n,i,t))return n}}),e.prototype={getCallbacks:function(e,t,i,n){var a=this.data.find(function(t,i,n){return t.element===e});if(!a){if(!n)return;a={element:e,events:[{},{}]},this.data.push(a)}var r=a.events[i?1:0],s=r[t];return!s&&n&&(r[t]=s=[]),s},add:function(e,t,i,n){var a=this.getCallbacks(e,t,n,!0);a.push(i)},remove:function(e,t,i,n){var a=this.getCallbacks(e,t,n);if(a){var r=a.indexOf(i);r>=0&&a.splice(r,1)}},forEachEvent:function(e){this.data.forEach(function(t){function i(i,n){for(var a in i){var r=i[a];r.forEach(function(i){e(t.element,a,i,n)})}}i(t.events[0],!1),i(t.events[1],!0)})}},t.prototype={threshold:5,initTouch:function(){var e=this,t=e.handler;e.touches={},e.on(e.parent,"touchstart",t),e.on(e.parent,"touchmove",t),e.on(e.parent,"touchend",t)},initMouse:function(){var e=this,t=e.handler;e.mouse={},e.on(e.parent,"mousedown",t),e.on(e.parent,"mousemove",t),e.on(e.parent,"mouseup",t)},on:function(e,t,i,n){this.events.add(e,t,i,n),e.addEventListener(t,i,n)},off:function(e,t,i,n){this.events.remove(e,t,i,n),e.removeEventListener(t,i,n)},delegate:function(e,t,i,n){this.delegates.add(e,t,i,n)},undelegate:function(e,t,i,n){this.delegates.remove(e,t,i,n)},forEach:function(e,t){Array.prototype.forEach.call(e,t)},fire:function(e,t){for(var i=this,n=function(n){var a=i.delegates.getCallbacks(n,e);a&&i.forEach(a,function(i){var a,r={type:e};for(a in t)r[a]=t[a];r.preventDefault=s,r.stopPropagation=o,i.call(n,r)})},a=!1,r=!1,s=function(){a=!0},o=function(){r=!0},l=t.target;l&&(n(l),!r&&l!==i.parent);)l=l.parentNode;return a},_handler:function(e){var t=this,i=t.touches,n=t.mouse,a=!1;"touchstart"==e.type?t.forEach(e.changedTouches,function(e){i[e.identifier]={evt:e},a=t.fire("mousedown",e)||a}):"touchmove"==e.type?t.forEach(e.changedTouches,function(e){var n=i[e.identifier],r=n.evt;n.moved=n.moved||Math.abs(e.clientX-r.clientX)>t.threshold||Math.abs(e.clientY-r.clientY)>t.threshold,n.moved&&(n.evt=e,a=t.fire("mousemove",e)||a)}):"touchend"==e.type?t.forEach(e.changedTouches,function(e){a=t.fire("mouseup",e)||a;var n=i[e.identifier];delete i[e.identifier],n&&!n.moved&&(a=t.fire("click",e)||a)}):"mousedown"==e.type?(n.moving=!0,n.moved=!1,a=t.fire("mousedown",e)||a):"mousemove"==e.type?n.moving&&(n.moved=!0,a=t.fire("mousemove",e)||a):"mouseup"==e.type&&(n.moving=!1,a=t.fire("mouseup",e)||a,n.moved||(a=t.fire("click",e)||a)),a&&e.preventDefault()},getPoint:function(e){if("offsetX"in e)return{x:e.offsetX,y:e.offsetY};var t=e.target.getBoundingClientRect(),i=document.documentElement,n=window;return{x:e.pageX-(t.left+n.pageXOffset-i.clientLeft),y:e.pageY-(t.top+n.pageYOffset-i.clientTop)}},destroy:function(){var e=this;e.events.forEachEvent(function(e,t,i,n){e.removeEventListener(t,i,n)}),e.delegates=null,e.events=null}},i.prototype={setLyric:function(e){var t=this.data=[];if(this.last=0,e){var i=/^\[([^\]]*)\]\s*(.*)$/;e.split(/\n/).forEach(function(e){var n=e.match(i);if(n){var a=0;n[1].split(/:/).forEach(function(e){a=60*a+Number(e)}),t.push([a,n[2]])}})}},getLyricAtTime:function(e){var t,i=this,n=i.data,a=i.last,r=n[a]||n[a=0];if(r)if(r[0]<e){for(;(t=n[++a])&&t[0]<=e;)r=t;i.last=a-1}else{for(;r&&r[0]>e;)r=n[--a];i.last=a}return r?r[1]:""}};var a=[];n.prototype={_classes:{list:"fa fa-list",prev:"fa fa-step-backward",play:"fa fa-play",next:"fa fa-step-forward",pause:"fa fa-pause"},themes:["normal","simple"],extend:function(e,t){for(var i in t)e[i]=t[i];return e},init:function(){var e=this,t=e.options.container;e.classes=e.extend({},e._classes),e.options.classes&&e.extend(e.classes,e.options.classes),t.classList.add("h5p");var n=e.themes.indexOf(e.options.theme);0>n&&(n=0),t.classList.add("h5p-"+(e.theme=e.themes[n])),t.innerHTML='<div class="h5p-image"></div><div class="h5p-buttons"><i data="list" class="h5p-button '+e.classes.list+'"></i></div><div class="h5p-info"><div class="h5p-title"></div><div class="h5p-artist"></div></div><div class="h5p-control"><i data="prev" class="h5p-button '+e.classes.prev+'"></i><i data="play" class="h5p-button '+e.classes.play+'"></i><i data="next" class="h5p-button '+e.classes.next+'"></i></div><div class="h5p-progress"><div class="h5p-wrap"><div class="h5p-bar"><div class="h5p-played"></div></div><div class="h5p-cursor"></div><div class="h5p-time"></div></div></div><div class="h5p-lyric"></div><div class="h5p-playlist"></div>';var a=t.querySelector.bind(t);e.image=a(".h5p-image"),e.title=a(".h5p-title"),e.artist=a(".h5p-artist"),e.playlist=a(".h5p-playlist"),e.prwrap=a(".h5p-wrap"),e.prcur=a(".h5p-cursor"),e.prtime=a(".h5p-time"),e.brplayed=a(".h5p-played"),e.lyric=a(".h5p-lyric"),Array.prototype.forEach.call(t.querySelectorAll(".h5p-button"),function(t){e["bt"+t.getAttribute("data")]=t}),e.audio=new Audio,e.options.image&&(e.image.innerHTML='<img src="'+e.safeHTML(e.options.image)+'">'),e.setSongs([]),e.lyricParser=new i,e.bindEvents()},bindEvents:function(){var e=this,i=null,n=e.evtHandler=new t(e.options.container);n.delegate(e.btlist,"click",e.toggleList.bind(e)),n.delegate(e.btprev,"click",e.playPrev.bind(e)),n.delegate(e.btnext,"click",e.playNext.bind(e)),n.delegate(e.btplay,"click",e.togglePlay.bind(e)),n.on(e.audio,"ended",e.playAnother.bind(e)),n.on(e.audio,"timeupdate",function(t){var n=this.currentTime,a=e.duration;if(a||(a=e.duration=this.duration),!i){var r=a?n/a*100+"%":0;e.prcur.style.left=r,e.brplayed.style.width=r}e.prtime.innerHTML=e.timestr(n)+" / "+e.timestr(a),e.lyric.innerHTML=e.safeHTML(e.lyricParser.getLyricAtTime(n))});var r=function(t){var i=["play","pause"],n=0;"play"==t.type?a.forEach(function(t){t!==e&&t.audio.pause()}):n=1;var r=e.btplay.classList;e.classes[i[n]].split(/\s+/).forEach(function(e){r.remove(e)}),e.classes[i[1-n]].split(/\s+/).forEach(function(e){r.add(e)}),e.image.classList["play"==t.type?"add":"remove"]("h5p-roll")};n.on(e.audio,"play",r),n.on(e.audio,"pause",r),n.delegate(e.playlist,"click",function(t){t.preventDefault();var i=Array.prototype.indexOf.call(this.childNodes,t.target);i>=0&&e.play(i)});var s=function(t,i){var n=t/e.prwrap.offsetWidth;0>n?n=0:n>1&&(n=1),e.prcur.style.left=e.brplayed.style.width=100*n+"%",i&&(e.audio.currentTime=~~(n*e.duration))};n.delegate(e.prwrap,"click",function(e){e.preventDefault();var t=n.getPoint(e).x;s(t,!0)});var o=function(e){i&&(i.moved=!0,s(e.clientX-i.delta))},l=function(e){i&&(e.preventDefault(),i=null)},c=function(e){i&&(s(e.clientX-i.delta,!0),l(e))},u=function(t){t.preventDefault(),i={delta:t.clientX-e.brplayed.offsetWidth}};n.delegate(e.prcur,"mousedown",u),n.delegate(e.options.container,"mousemove",o),n.delegate(e.options.container,"mouseup",c),n.on(e.options.container,"mouseleave",l)},safeHTML:function(e){return e.replace(/[&"<]/g,function(e){return{"&":"&amp;",'"':"&quot;","<":"&lt;"}[e]})},toggleList:function(e){e.preventDefault();var t=this;t.btlist.classList.toggle("h5p-active");var i=t.playlist.style.display;t.playlist.style.display=i?"":"block"},togglePlay:function(e){e.preventDefault();var t=this;t.current<0?t.play(0):t.audio.paused?t.audio.play():t.audio.pause()},playPrev:function(e){e&&e.preventDefault(),this.play(this.previous())},playNext:function(e){e&&e.preventDefault(),this.play(this.next())},playAnother:function(){this.playNext()},setSongs:function(e){var t=this,i=[];t.songs=e,t.songs.forEach(function(e){var n=t.safeHTML(e.name);i.push('<div title="'+n+'">'+n+"</div>")}),t.playlist.innerHTML=i.join(""),t.current=-1,t.audio.src="",t.duration=0,t.showInfo(t.songs[0])},showInfo:function(e){var t,i=this;e=e||{},"simple"==i.theme&&(t=e.smallimage||i.options.smallimage),t=t||e.image||i.options.image||"",t&&(i.image.innerHTML='<img src="'+i.safeHTML(t)+'">'),i.title.innerHTML=i.safeHTML(e.name||""),i.artist.innerHTML=i.safeHTML(e.artist||"")},getLyric:function(e){var t=this,i=t.songs[t.current];if("lyric"in i)t.lyricParser.setLyric(i.lyric);else if(t.lyricParser.setLyric(),"lyricjsonp"in i){var n,a="setLyric"+Date.now().toString(16)+(~~(65535*Math.random())).toString(16);window[a]=function(e){200!=e.code?i.lyric=null:(i.lyric=e.lyric,i===t.songs[t.current]&&t.lyricParser.setLyric(i.lyric)),delete window[a],n&&(clearTimeout(n),n=null)};var r=document.createElement("script");r.src=i.lyricjsonp+(/\?/.test(i.lyricjsonp)?"&":"?")+"jsonp="+a,r.onload=function(){document.body.removeChild(r)},document.body.appendChild(r),e&&(n=setTimeout(function(){delete window[a],n=null},e))}},play:function(e){var t=this;if(e>=0&&e<t.songs.length){if(t.current==e)t.audio.currentTime=0;else{var i=t.playlist.childNodes,n=i[t.current];n&&n.classList.remove("h5p-active"),t.current=e,i[t.current].classList.add("h5p-active");var a=t.songs[t.current];t.audio.src=a.url,t.duration=a.duration?a.duration/1e3:null,t.showInfo(a),"simple"!=t.theme&&(t.lyric.innerHTML="",t.getLyric(1e4))}t.prtime.innerHTML="",t.prcur.style.left=0,t.brplayed.style.width=0,t.audio.play()}},previous:function(){return(this.current+this.songs.length-1)%this.songs.length},next:function(){return(this.current+1)%this.songs.length},timestr:function(e){if(isNaN(e))return"??:??";var t=Math.floor(e/60);return e=Math.floor(e)%60,10>e&&(e="0"+e),10>t&&(t="0"+t),t+":"+e},destroy:function(){var e=this;e.evtHandler.destroy(),e.evtHandler=null,e.lyricParser=null,e.audio.src="",e.audio=null,e.options.container.innerHTML="",e.options.container.classList.remove("h5p");var t=a.indexOf(this);t>=0&&a.splice(t,1)}},window.Player=n}).call({});